<!DOCTYPE HTML>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Gestión VC</title>
    <link href="styles/style.css" rel="stylesheet" type="text/css">
    <link href="styles/framework.css" rel="stylesheet" type="text/css">
    <link href="styles/owl.carousel.css" rel="stylesheet" type="text/css">
    <link href="styles/owl.theme.css" rel="stylesheet" type="text/css">
    <link href="styles/swipebox.css" rel="stylesheet" type="text/css">
    <link href="styles/colorbox.css" rel="stylesheet" type="text/css">
    <style>
        .star
        {
            padding-left: 25px;
            padding-bottom: 10px;
            display: inline;
        }
    </style>
    <script type="text/javascript" src="scripts/jquery.js"></script>
    <script type="text/javascript" src="scripts/jqueryui.js"></script>
    <script type="text/javascript" src="scripts/owl.carousel.min.js"></script>
    <script type="text/javascript" src="scripts/jquery.swipebox.js"></script>
    <script type="text/javascript" src="scripts/colorbox.js"></script>
    <script type="text/javascript" src="scripts/snap.js"></script>
    <script type="text/javascript" src="scripts/contact.js"></script>
    <script type="text/javascript" src="scripts/custom.js"></script>
    <script type="text/javascript" src="scripts/framework.js"></script>
    <script type="text/javascript" src="scripts/framework.launcher.js"></script>
    <script type="text/javascript" src="scripts/bd.js"></script>
</head>
<body>
    <div id="preloader">
        <div id="status">
            <p class="center-text">
                Cargando contenido... <em>La carga depende de su conexión a internet</em>
            </p>
        </div>
    </div>
    <div class="all-elements">
          <div id="sidebar" class="page-sidebar">
            <div class="page-sidebar-scroll">
                <div class="sidebar-shortcuts">
					<a href="#" class="shortcut-closedsession" title="Cerrar Sesión" onclick="closedSession();"></a>
                    <a href="#" class="shortcut-close"></a>
                </div>
                
                <div class="sidebar-search">
                    <div class="search-box">
                        <input type="text" class="search-field" name="search" onfocus="if(this.value == 'Looking for something?') { this.value = ''; }" value="Looking for something?">
                        <a href="#" class="search-close"></a>
                    </div>
                </div>
                
                <div class="sidebar-logo">
                    <img src="images/drugs/logo_odc.png" height="52" alt="img">
                </div>
                
                <div class="sidebar-breadcrumb">NAVEGACIÓN</div>                
                <div class="sidebar-decoration"></div>
                <div class="navigation-item">
                    <a href="inicio-sesion.html" class="nav-item home-locales">Sincronizar<em class="unselected-item"></em></a>
                </div>
                <div class="sidebar-decoration"></div>
                <div class="navigation-item">
                    <a href="registro_cliente.html" class="nav-item home-locales">Registrar cliente<em class="unselected-item"></em></a>
                </div>
                <div class="sidebar-decoration"></div>
				<div class="navigation-item">
                    <a href="lista_clientes.html" class="nav-item home-locales">Listado Clientes<em class="unselected-item"></em></a>
                </div>
				<div class="sidebar-decoration"></div>
				<div class="navigation-item">
                    <a href="reporte_preliquidacion.html" class="nav-item home-locales">Preliquidación<em class="unselected-item"></em></a>
                </div>
				<div class="sidebar-decoration"></div>
				<div class="navigation-item">
                    <a href="recaudos_prestamos_registrados.html" class="nav-item home-locales">Recaudos y Prestamos<em class="unselected-item"></em></a>
                </div>
				<div class="sidebar-decoration"></div>
                
                <div class="sidebar-breadcrumb">
                </div>
            </div>         
          </div>
        <div id="content" class="page-content">
            <div class="page-header">
                <a href="#" class="deploy-sidebar"></a>
                <img class="header-logo" src="images/drugs/odc-texto.png" width="71" alt="img">
                
            </div>
            <div class="page-header-clear">
            </div>
            <div class="content">
                <div class="decoration">
                </div>
                <div class="container no-bottom" style="text-align: center;">
                    <h3>
                        LISTADO DE CLIENTES</h3>
                </div>
                <div class="decoration">
                </div>
                <div class="container no-bottom">
                    <div class="big-notification blue-notification">
                        <h4 class="uppercase">
                            AYUDA</h4>
                        <a href="#" class="close-big-notification">x</a>
                        <p>
                            En este módulo podrá gestionar sus clientes.
                        </p>
                    </div>
                </div>
               
                <br />
                <div class="container no-bottom">
                    <h4>
                        Listado de Clientes
                    </h4>
                </div>
                 <div class="formFieldWrap">
                    <label class="field-title contactNameField" for="contactNameField">
                        Nombre, Código interno o cédula del cliente a buscar:</label>
                    <input type="text" name="contactNameField" value="" class="contactField requiredField"
                        id="txtCodigo" />
                </div>
                <div class="formSubmitButtonErrorsWrap">
                    <input type="submit" class="buttonWrap button button-dark contactSubmitButton" id="contactSubmitButton"
                        value="Buscar" data-formid="contactForm" onclick="buscarCliente();" />
                        <input type="submit" class="buttonWrap button button-dark contactSubmitButton" id="contactSubmitButton"
                        value="Mostrar todos" data-formid="contactForm" onclick="consultarClientes();" />
                </div>
                <br />
                <div id="div_Clientes">
                    
                </div>
                <div class="decoration">
                </div>
                <div class="container">
                    <div class="footer-socials">
                        <a href="#" class="facebook-footer"></a><a href="#" class="goup-footer"></a><a href="#"
                            class="twitter-footer"></a>
                    </div>
                    <p class="copyright uppercase center-text no-bottom">
                        Gestión de cobros 2014<br>
                        Todos los derechos reservados</p>
                </div>
            </div>
        </div>
    </div>
    </div>
    <style>
        .submenu-nav-items a
        {
            padding-left: 20px !important;
            padding-top: 10px !important;
            padding-bottom: 10px !important;
            border-bottom: solid 1px rgba(0,0,0,0.1) !important;
        }
        
        .vinculo_derecha
        {
            float: right;
            padding-right: 1%;
        }
        
        .vinculo_izquierda
        {
            float: left;
            padding-left: 1%;
            display: none;
        }
    </style>
    <script>
        $( document ).ready(function() {
		  if(sessionStorage.getItem("estadoLogin") == "Exitoso"){
			  var usuario = localStorage.getItem("idGestor");
			  consultarClientes();
		  }else{
				location.href = "index.html";
			}
        });

		function closedSession(){
		    sessionStorage.setItem("estadoLogin", "");
			location.href = "index.html";
		}

        function errorGeneralBD(err) {
            console.log(err);
        }

        function consultarClientes() {
            var db = window.openDatabase("bd_cobros", "1.0", "Gestion cobros", 200000);
            db.transaction(consultar_clientes, errorGeneralBD, function () {
            });
        }

        function consultar_clientes(tx) {
            tx.executeSql("SELECT * FROM clientes", [], llenar_clientes, function (error) {
            });
        }

        function llenar_clientes(tx, results) {
            var len = results.rows.length;
            var texto="";
			
            if (len > 0) {
                for (var i = 0; i < len; i++) {
				var imgcalidad="";
				    if(results.rows.item(i).Calificacion == 1){ 
					   imgcalidad="<a href='#' class='circleExcelente'>";
					} 
					if(results.rows.item(i).Calificacion == 2){ 
						imgcalidad="<a href='#' class='circleMedio'>";
					} 
					if(results.rows.item(i).Calificacion == 3){ 
						imgcalidad="<a href='#' class='circleMalo'>";
					}
                    texto+='<div class="container"><div class="toggle-2"><a href="#" class="deploy-toggle-2">'+results.rows.item(i).Nombre+ ' - ' + results.rows.item(i).CodCliente +' '+imgcalidad+'</a><div class="toggle-content"><div class="one-half-responsive "><div class="submenu-navigation"><div class="submenu-nav-items" style="overflow: hidden; display: block;"></div><a href="#" style="border-top: solid 1px rgba(0,0,0,0.1); padding-left: 20px !important; padding-top: 10px !important; padding-bottom: 10px !important; border-bottom: solid 1px rgba(0,0,0,0.1) !important;"><ul style="margin-bottom:0px;" class="icon-list"><li class="right-list">Tel. '+results.rows.item(i).Telefono+'</li></ul></a><a href="#" style="border-top: solid 1px rgba(0,0,0,0.1); padding-left: 20px !important; padding-top: 10px !important; padding-bottom: 10px !important; border-bottom: solid 1px rgba(0,0,0,0.1) !important;"><ul style="margin-bottom:0px;" class="icon-list"><li class="right-list">Cédula: '+results.rows.item(i).NroIdentificacion+'</li></ul></a><br /><input type="button" class="buttonWrap button button-dark contactSubmitButton" id="contactSubmitButton" value="Consultar" onclick="consultarCobros('+results.rows.item(i).CodCliente+');" /><br /></div></div></div></div></div>';
                }
                document.getElementById("div_Clientes").innerHTML = texto;
                $('.deploy-toggle-2').click(function () {
                    $(this).parent().find('.toggle-content').toggle(100);
                    $(this).toggleClass('toggle-2-active');
                    return false;
                });
            }
            else {
                alert("No se encontraron clientes.");
            }
        }

        function consultarCobros(codCliente){
            localStorage.setItem("clienteConsultado", codCliente);
            localStorage.setItem("idGestor", localStorage.getItem("idGestor"));
            location.href = "datos_cobro.html";
        }

        function buscarCliente(){
            if($('#txtCodigo').val() == ""){
                alert("Debe ingresar un código, cédula o nombre.")
            }
            else{
                var db = window.openDatabase("bd_cobros", "1.0", "Gestion cobros", 200000);
                db.transaction(buscar_cliente, errorGeneralBD, function () {
                });
            }
        }

        function buscar_cliente(tx) {
            tx.executeSql("SELECT * FROM clientes WHERE CodCliente = '"+$('#txtCodigo').val()+"' OR NroIdentificacion='"+$('#txtCodigo').val()+"' OR Nombre LIKE '%"+$('#txtCodigo').val()+"%'", [], llenar_clientes, function (error) {
            });
        }

    </script>
</body>
</html> 